Starting ArcFace Loss training...
Job ID: 197168
Node: node-38
Working dir: /scratch/lustre/home/vymi9180/Kursinis
Wed Dec 31 02:30:50 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.144.03             Driver Version: 550.144.03     CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla V100-SXM2-32GB           On  |   00000000:06:00.0 Off |                    0 |
| N/A   30C    P0             41W /  300W |       1MiB /  32768MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
GPU: Tesla V100-SXM2-32GB

[Setup] Loading DINOv2 model...
Loading DINOv2 backbone: dinov2_vits14...
Backbone weights frozen.
Model created: dinov2_vits14 -> 128D embeddings
[Setup] Model ready on cuda
[Setup] Initializing arcface loss...
[Setup] Loss function ready: arcface
[Setup] Optimizer ready: AdamW with lr=0.0004
[Setup] Loading datasets...
[DISC21TrainDataset] Found 50000 images in data/train
[DISC21EvalDataset] Found 50000 images in data/queries_dev
[DISC21EvalDataset] Found 50000 images in data/refs
[load_groundtruth] Loaded 10000 query-reference pairs from data/dev_queries_groundtruth.csv
[Setup] ArcFace head ready with 50000 classes
[Setup] Training samples: 50000
[Setup] Validation queries: 50000
[Setup] Validation refs: 50000

======================================================================
TRAINING: ARCFACE LOSS
======================================================================
Epochs: 0 -> 20
Batch size: 1024
Learning rate: 0.0004
Device: cuda
Checkpoint every: 30 minutes
======================================================================


[Epoch 0] Loss: 27.3637 | LR: 3.98e-05 | Time: 4.0min
[Checkpoint] Saved: arcface_epoch_000_epoch.pt

[Epoch 1] Loss: 21.5262 | LR: 3.90e-05 | Time: 3.9min
[Checkpoint] Saved: arcface_epoch_001_epoch.pt

[Epoch 2] Loss: 16.8842 | LR: 3.79e-05 | Time: 3.9min
[Checkpoint] Saved: arcface_epoch_002_epoch.pt

[Epoch 3] Loss: 12.8960 | LR: 3.63e-05 | Time: 3.9min
[Checkpoint] Saved: arcface_epoch_003_epoch.pt
[Checkpoint] Removed old: arcface_epoch_000_epoch.pt

[Epoch 4] Loss: 9.3277 | LR: 3.43e-05 | Time: 3.9min
[Checkpoint] Saved: arcface_epoch_004_epoch.pt
[Checkpoint] Removed old: arcface_epoch_001_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5784
  Precision@5: 0.6314
  Precision@10: 0.6427
  mAP: 0.6021
  uAP: 0.4488
[Checkpoint] Saved: arcface_epoch_004_best.pt
[Checkpoint] New best model saved!
[Epoch 4] Validation P@1: 0.5784 (Best: 0.5784)

[Epoch 5] Loss: 6.3330 | LR: 3.20e-05 | Time: 3.9min
[Checkpoint] Saved: arcface_epoch_005_epoch.pt
[Checkpoint] Removed old: arcface_epoch_002_epoch.pt

[Epoch 6] Loss: 4.0606 | LR: 2.94e-05 | Time: 3.8min
[Checkpoint] Saved: arcface_epoch_006_epoch.pt
[Checkpoint] Removed old: arcface_epoch_003_epoch.pt

[Epoch 7] Loss: 2.5792 | LR: 2.65e-05 | Time: 3.8min
[Checkpoint] Saved: arcface_epoch_007_epoch.pt
[Checkpoint] Removed old: arcface_epoch_004_epoch.pt

[Epoch 8] Loss: 1.7115 | LR: 2.36e-05 | Time: 3.8min
[Checkpoint] Saved: arcface_epoch_008_epoch.pt
[Checkpoint] Removed old: arcface_epoch_005_epoch.pt

[Epoch 9] Loss: 1.2049 | LR: 2.05e-05 | Time: 3.8min
[Checkpoint] Saved: arcface_epoch_009_epoch.pt
[Checkpoint] Removed old: arcface_epoch_006_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5841
  Precision@5: 0.6295
  Precision@10: 0.6333
  mAP: 0.6041
  uAP: 0.4882
[Checkpoint] Saved: arcface_epoch_009_best.pt
[Checkpoint] New best model saved!
[Epoch 9] Validation P@1: 0.5841 (Best: 0.5841)

[Epoch 10] Loss: 0.9045 | LR: 1.74e-05 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_010_epoch.pt
[Checkpoint] Removed old: arcface_epoch_007_epoch.pt

[Epoch 11] Loss: 0.7163 | LR: 1.45e-05 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_011_epoch.pt
[Checkpoint] Removed old: arcface_epoch_008_epoch.pt

[Epoch 12] Loss: 0.5896 | LR: 1.16e-05 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_012_epoch.pt
[Checkpoint] Removed old: arcface_epoch_009_epoch.pt

[Epoch 13] Loss: 0.5069 | LR: 9.04e-06 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_013_epoch.pt
[Checkpoint] Removed old: arcface_epoch_010_epoch.pt

[Epoch 14] Loss: 0.4503 | LR: 6.71e-06 | Time: 3.6min
[Checkpoint] Saved: arcface_epoch_014_epoch.pt
[Checkpoint] Removed old: arcface_epoch_011_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5841
  Precision@5: 0.6314
  Precision@10: 0.6389
  mAP: 0.6050
  uAP: 0.4988
[Epoch 14] Validation P@1: 0.5841 (Best: 0.5841)

[Epoch 15] Loss: 0.4108 | LR: 4.72e-06 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_015_epoch.pt
[Checkpoint] Removed old: arcface_epoch_012_epoch.pt

[Epoch 16] Loss: 0.3886 | LR: 3.13e-06 | Time: 3.6min
[Checkpoint] Saved: arcface_epoch_016_epoch.pt
[Checkpoint] Removed old: arcface_epoch_013_epoch.pt

[Epoch 17] Loss: 0.3702 | LR: 1.95e-06 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_017_epoch.pt
[Checkpoint] Removed old: arcface_epoch_014_epoch.pt

[Epoch 18] Loss: 0.3596 | LR: 1.24e-06 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_018_epoch.pt
[Checkpoint] Removed old: arcface_epoch_015_epoch.pt

[Epoch 19] Loss: 0.3526 | LR: 1.00e-06 | Time: 3.7min
[Checkpoint] Saved: arcface_epoch_019_epoch.pt
[Checkpoint] Removed old: arcface_epoch_016_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5841
  Precision@5: 0.6314
  Precision@10: 0.6371
  mAP: 0.6046
  uAP: 0.5004
[Epoch 19] Validation P@1: 0.5841 (Best: 0.5841)

======================================================================
TRAINING COMPLETE
======================================================================
Total time: 1.63 hours
Best P@1: 0.5841
Best checkpoint: checkpoints/arcface_best.pt
======================================================================
Training history saved to: logs/arcface_history.json
Training complete!
