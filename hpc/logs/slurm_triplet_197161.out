Starting Triplet Loss training...
Job ID: 197161
Node: node-38
Working dir: /scratch/lustre/home/vymi9180/Kursinis
Wed Dec 31 00:09:15 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.144.03             Driver Version: 550.144.03     CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla V100-SXM2-32GB           On  |   00000000:06:00.0 Off |                    0 |
| N/A   30C    P0             41W /  300W |       1MiB /  32768MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
GPU: Tesla V100-SXM2-32GB

[Setup] Loading DINOv2 model...
Loading DINOv2 backbone: dinov2_vits14...
Backbone weights frozen.
Model created: dinov2_vits14 -> 128D embeddings
[Setup] Model ready on cuda
[Setup] Initializing triplet loss...
[Setup] Loss function ready: triplet
[Setup] Optimizer ready: AdamW with lr=0.0004
[Setup] Loading datasets...
[DISC21TrainDataset] Found 50000 images in data/train
[DISC21EvalDataset] Found 50000 images in data/queries_dev
[DISC21EvalDataset] Found 50000 images in data/refs
[load_groundtruth] Loaded 10000 query-reference pairs from data/dev_queries_groundtruth.csv
[Setup] Training samples: 50000
[Setup] Validation queries: 50000
[Setup] Validation refs: 50000

======================================================================
TRAINING: TRIPLET LOSS
======================================================================
Epochs: 0 -> 20
Batch size: 1024
Learning rate: 0.0004
Device: cuda
Checkpoint every: 30 minutes
======================================================================


[Epoch 0] Loss: 0.0000 | LR: 3.98e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_000_epoch.pt
[Checkpoint] Removed old: triplet_epoch_000_epoch.pt

[Epoch 1] Loss: 0.0000 | LR: 3.90e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_001_epoch.pt
[Checkpoint] Removed old: triplet_epoch_001_epoch.pt

[Epoch 2] Loss: 0.0000 | LR: 3.79e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_002_epoch.pt
[Checkpoint] Removed old: triplet_epoch_002_epoch.pt

[Epoch 3] Loss: 0.0000 | LR: 3.63e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_003_epoch.pt
[Checkpoint] Removed old: triplet_epoch_003_epoch.pt

[Epoch 4] Loss: 0.0000 | LR: 3.43e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_004_epoch.pt
[Checkpoint] Removed old: triplet_epoch_004_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5671
  Precision@5: 0.6219
  Precision@10: 0.6408
  mAP: 0.5943
  uAP: 0.4221
[Checkpoint] Saved: triplet_epoch_004_best.pt
[Checkpoint] New best model saved!
[Epoch 4] Validation P@1: 0.5671 (Best: 0.5671)

[Epoch 5] Loss: 0.0000 | LR: 3.20e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_005_epoch.pt
[Checkpoint] Removed old: triplet_epoch_005_epoch.pt

[Epoch 6] Loss: 0.0000 | LR: 2.94e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_006_epoch.pt
[Checkpoint] Removed old: triplet_epoch_006_epoch.pt

[Epoch 7] Loss: 0.0000 | LR: 2.65e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_007_epoch.pt
[Checkpoint] Removed old: triplet_epoch_007_epoch.pt

[Epoch 8] Loss: 0.0000 | LR: 2.36e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_008_epoch.pt

[Epoch 9] Loss: 0.0000 | LR: 2.05e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_009_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5671
  Precision@5: 0.6219
  Precision@10: 0.6408
  mAP: 0.5943
  uAP: 0.4221
[Epoch 9] Validation P@1: 0.5671 (Best: 0.5671)

[Epoch 10] Loss: 0.0000 | LR: 1.74e-05 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_010_epoch.pt
[Checkpoint] Removed old: triplet_epoch_008_epoch.pt

[Epoch 11] Loss: 0.0000 | LR: 1.45e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_011_epoch.pt
[Checkpoint] Removed old: triplet_epoch_008_timed.pt

[Epoch 12] Loss: 0.0000 | LR: 1.16e-05 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_012_epoch.pt
[Checkpoint] Removed old: triplet_epoch_009_epoch.pt

[Epoch 13] Loss: 0.0000 | LR: 9.04e-06 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_013_epoch.pt
[Checkpoint] Removed old: triplet_epoch_010_epoch.pt

[Epoch 14] Loss: 0.0000 | LR: 6.71e-06 | Time: 4.1min
[Checkpoint] Saved: triplet_epoch_014_epoch.pt
[Checkpoint] Removed old: triplet_epoch_011_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5671
  Precision@5: 0.6219
  Precision@10: 0.6408
  mAP: 0.5943
  uAP: 0.4221
[Epoch 14] Validation P@1: 0.5671 (Best: 0.5671)

[Epoch 15] Loss: 0.0000 | LR: 4.72e-06 | Time: 4.0min
[Checkpoint] Saved: triplet_epoch_015_epoch.pt
[Checkpoint] Removed old: triplet_epoch_012_epoch.pt

[Epoch 16] Loss: 0.0000 | LR: 3.13e-06 | Time: 3.9min
[Checkpoint] Saved: triplet_epoch_016_epoch.pt
[Checkpoint] Removed old: triplet_epoch_013_epoch.pt

[Epoch 17] Loss: 0.0000 | LR: 1.95e-06 | Time: 3.9min
[Checkpoint] Saved: triplet_epoch_017_epoch.pt
[Checkpoint] Removed old: triplet_epoch_014_epoch.pt

[Epoch 18] Loss: 0.0000 | LR: 1.24e-06 | Time: 3.9min
[Checkpoint] Saved: triplet_epoch_018_epoch.pt
[Checkpoint] Removed old: triplet_epoch_015_epoch.pt

[Epoch 19] Loss: 0.0000 | LR: 1.00e-06 | Time: 3.9min
[Checkpoint] Saved: triplet_epoch_019_epoch.pt
[Checkpoint] Removed old: triplet_epoch_016_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5671
  Precision@5: 0.6219
  Precision@10: 0.6408
  mAP: 0.5943
  uAP: 0.4221
[Epoch 19] Validation P@1: 0.5671 (Best: 0.5671)

======================================================================
TRAINING COMPLETE
======================================================================
Total time: 1.73 hours
Best P@1: 0.5671
Best checkpoint: checkpoints/triplet_best.pt
======================================================================
Training history saved to: logs/triplet_history.json
Training complete!
