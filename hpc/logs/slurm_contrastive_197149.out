Starting Contrastive Loss training...
Job ID: 197149
Node: node-38
Working dir: /scratch/lustre/home/vymi9180/Kursinis
Tue Dec 30 22:05:19 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 550.144.03             Driver Version: 550.144.03     CUDA Version: 12.4     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  Tesla V100-SXM2-32GB           On  |   00000000:06:00.0 Off |                    0 |
| N/A   30C    P0             41W /  300W |       1MiB /  32768MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
GPU: Tesla V100-SXM2-32GB

[Setup] Loading DINOv2 model...
Loading DINOv2 backbone: dinov2_vits14...
Backbone weights frozen.
Model created: dinov2_vits14 -> 128D embeddings
[Setup] Model ready on cuda
[Setup] Initializing contrastive loss...
[Setup] Loss function ready: contrastive
[Setup] Optimizer ready: AdamW with lr=0.0001
[Setup] Loading datasets...
[DISC21TrainDataset] Found 50000 images in data/train
[DISC21EvalDataset] Found 50000 images in data/queries_dev
[DISC21EvalDataset] Found 50000 images in data/refs
[load_groundtruth] Loaded 10000 query-reference pairs from data/dev_queries_groundtruth.csv
[Setup] Training samples: 50000
[Setup] Validation queries: 50000
[Setup] Validation refs: 50000

======================================================================
TRAINING: CONTRASTIVE LOSS
======================================================================
Epochs: 0 -> 20
Batch size: 256
Learning rate: 0.0001
Device: cuda
Checkpoint every: 30 minutes
======================================================================


[Epoch 0] Loss: 0.0788 | LR: 9.94e-06 | Time: 7.6min
[Checkpoint] Saved: contrastive_epoch_000_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_000_epoch.pt

[Epoch 1] Loss: 0.0744 | LR: 9.78e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_001_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_001_epoch.pt

[Epoch 2] Loss: 0.0765 | LR: 9.51e-06 | Time: 4.2min
[Checkpoint] Saved: contrastive_epoch_002_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_002_epoch.pt

[Epoch 3] Loss: 0.0718 | LR: 9.14e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_003_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_003_epoch.pt

[Epoch 4] Loss: 0.0709 | LR: 8.68e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_004_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_004_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5520
  Precision@5: 0.6068
  Precision@10: 0.6238
  mAP: 0.5788
  uAP: 0.4691
[Checkpoint] Saved: contrastive_epoch_004_best.pt
[Checkpoint] New best model saved!
[Epoch 4] Validation P@1: 0.5520 (Best: 0.5520)

[Epoch 5] Loss: 0.0651 | LR: 8.15e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_005_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_005_epoch.pt

[Epoch 6] Loss: 0.0654 | LR: 7.54e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_006_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_006_epoch.pt

[Epoch 7] Loss: 0.0650 | LR: 6.89e-06 | Time: 3.8min
[Checkpoint] Saved: contrastive_epoch_007_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_007_epoch.pt

[Epoch 8] Loss: 0.0621 | LR: 6.20e-06 | Time: 3.8min
[Checkpoint] Saved: contrastive_epoch_008_epoch.pt

[Epoch 9] Loss: 0.0603 | LR: 5.50e-06 | Time: 3.8min
[Checkpoint] Saved: contrastive_epoch_009_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5539
  Precision@5: 0.6049
  Precision@10: 0.6276
  mAP: 0.5790
  uAP: 0.4790
[Checkpoint] Saved: contrastive_epoch_009_best.pt
[Checkpoint] New best model saved!
[Epoch 9] Validation P@1: 0.5539 (Best: 0.5539)

[Epoch 10] Loss: 0.0569 | LR: 4.80e-06 | Time: 3.9min
[Checkpoint] Saved: contrastive_epoch_010_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_008_epoch.pt

[Epoch 11] Loss: 0.0568 | LR: 4.11e-06 | Time: 3.9min
[Checkpoint] Saved: contrastive_epoch_011_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_008_timed.pt

[Epoch 12] Loss: 0.0568 | LR: 3.46e-06 | Time: 3.9min
[Checkpoint] Saved: contrastive_epoch_012_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_009_epoch.pt

[Epoch 13] Loss: 0.0601 | LR: 2.85e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_013_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_010_epoch.pt

[Epoch 14] Loss: 0.0610 | LR: 2.32e-06 | Time: 3.9min
[Checkpoint] Saved: contrastive_epoch_014_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_011_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5482
  Precision@5: 0.6049
  Precision@10: 0.6276
  mAP: 0.5744
  uAP: 0.4824
[Epoch 14] Validation P@1: 0.5482 (Best: 0.5539)

[Epoch 15] Loss: 0.0569 | LR: 1.86e-06 | Time: 3.9min
[Checkpoint] Saved: contrastive_epoch_015_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_012_epoch.pt

[Epoch 16] Loss: 0.0529 | LR: 1.49e-06 | Time: 4.0min
[Checkpoint] Saved: contrastive_epoch_016_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_013_epoch.pt

[Epoch 17] Loss: 0.0606 | LR: 1.22e-06 | Time: 4.1min
[Checkpoint] Saved: contrastive_epoch_017_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_014_epoch.pt

[Epoch 18] Loss: 0.0529 | LR: 1.06e-06 | Time: 4.1min
[Checkpoint] Saved: contrastive_epoch_018_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_015_epoch.pt

[Epoch 19] Loss: 0.0537 | LR: 1.00e-06 | Time: 4.1min
[Checkpoint] Saved: contrastive_epoch_019_epoch.pt
[Checkpoint] Removed old: contrastive_epoch_016_epoch.pt

[Validation] Extracting embeddings...
[Validation] Computing metrics...
Computing similarity matrix...
  Precision@1: 0.5520
  Precision@5: 0.6030
  Precision@10: 0.6276
  mAP: 0.5771
  uAP: 0.4836
[Epoch 19] Validation P@1: 0.5520 (Best: 0.5539)

======================================================================
TRAINING COMPLETE
======================================================================
Total time: 1.77 hours
Best P@1: 0.5539
Best checkpoint: checkpoints/contrastive_best.pt
======================================================================
Training history saved to: logs/contrastive_history.json
Training complete!
